<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Live bus tracker for ETUSA Algiers with real-time countdowns">
    <meta name="theme-color" content="#00d2ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ŸàÿµŸÑ ÿßŸÑÿ®ÿßÿµ">
    <meta name="mobile-web-app-capable" content="yes">

    <title>ŸàÿµŸÑ ÿßŸÑÿ®ÿßÿµ - Wsal El Bus</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.webmanifest">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="./pwa-mobile.css">
    <link rel="stylesheet" href="./station-modal.css">
    <link rel="stylesheet" href="./version-footer.css">
    <link rel="stylesheet" href="./weather-display.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./leaflet.css" />

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="16x16" href="./images/icon16.png">
    <link rel="icon" type="image/png" sizes="48x48" href="./images/icon48.png">
    <link rel="icon" type="image/png" sizes="128x128" href="./images/icon128.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./images/icon192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./images/icon512.png">
    <link rel="apple-touch-icon" href="./images/icon192.png">
</head>

<body>
    <div class="app-container">
        <header class="glass-header">
            <div class="logo-area">
                <h1 class="arabic-title">ŸàÿµŸÑ ÿßŸÑÿ®ÿßÿµ</h1>
                <span class="live-badge">LIVE</span>
            </div>
            <div class="time-display" id="algiers-time" style="display: none;">--:--</div>
        </header>

        <!-- Map View (Top 60%) -->
        <div id="map-view" class="map-view-container">
            <div id="map-container"></div>
            <!-- Hidden element for JS compatibility -->
            <p id="map-distance" style="display: none;"></p>
        </div>

        <!-- Walking Time Badge (floating above map) -->
        <div class="walking-time-badge hidden" id="walking-time">
            <svg class="walk-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M13.5 5.5C13.5 6.88071 12.3807 8 11 8C9.61929 8 8.5 6.88071 8.5 5.5C8.5 4.11929 9.61929 3 11 3C12.3807 3 13.5 4.11929 13.5 5.5Z"
                    fill="currentColor" />
                <path d="M9.5 9L7 13L9 14L10 18L8 21H10L11.5 17.5L13 21H15L13 18L14 14L16 13L13.5 9H9.5Z"
                    fill="currentColor" />
            </svg>
            <span id="walk-time-text">Calculating...</span>
        </div>

        <!-- Map Controls Stack (below walking badge) -->
        <div class="map-controls-stack">
            <!-- Location Button -->
            <button class="map-control-btn" id="locate-btn" title="Center on my location">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="3" fill="currentColor" />
                    <path d="M12 2V6M12 18V22M22 12H18M6 12H2" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                </svg>
            </button>

            <!-- Compass Button -->
            <button class="map-control-btn" id="compass-btn" title="North indicator">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L15 10L12 8L9 10L12 2Z" fill="#FF0055" />
                    <path d="M12 22L9 14L12 16L15 14L12 22Z" fill="#666" />
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none" />
                </svg>
                <span class="compass-label">N</span>
            </button>
        </div>

        <!-- Floating Station Control (Middle Overlap) -->
        <div id="floating-controls" class="floating-controls">
            <div class="station-selector-card" id="station-selector-trigger">
                <div class="station-info-left">
                    <span class="station-icon">üöè</span>
                    <div class="station-text-group">
                        <h2 id="station-name">Loading...</h2>
                        <div class="station-subtext">Tap to change station</div>
                    </div>
                </div>
                <div class="station-select-icon">‚ãÆ</div>
            </div>
        </div>

        <!-- Arrivals Panel (Bottom 40%) -->
        <div id="arrivals-panel" class="arrivals-panel panel-green">
            <!-- Algiers Skyline Backdrop (bottom-anchored) -->
            <div class="skyline-bg" aria-hidden="true">
                <svg viewBox="0 0 1200 140" preserveAspectRatio="xMidYMax slice" xmlns="http://www.w3.org/2000/svg">
                    <!-- Far skyline layer -->
                    <g fill="rgba(0,0,0,0.10)">
                        <path d="M0 140 L0 120 L40 120 L40 105 L70 105 L70 115 L110 115 L110 90 L150 90 L150 110 L190 110 L190 95 L230 95 L230 80 L260 80 L260 115 L300 115 L300 100 L340 100 L340 120 L380 120 L380 85 L420 85 L420 115 L460 115 L460 100 L500 100 L500 120 L540 120 L540 90 L580 90 L580 120 L620 120 L620 100 L660 100 L660 115 L700 115 L700 95 L740 95 L740 120 L780 120 L780 90 L820 90 L820 110 L860 110 L860 85 L900 85 L900 115 L940 115 L940 100 L980 100 L980 120 L1020 120 L1020 90 L1060 90 L1060 120 L1100 120 L1100 105 L1140 105 L1140 120 L1200 120 L1200 140 Z"/>
                    </g>
                    <!-- Near skyline with refined Algiers landmarks -->
                    <g fill="rgba(0,0,0,0.18)">
                        <!-- Ketchaoua Mosque (Casbah) - twin minarets + central dome -->
                        <rect x="302" y="92" width="10" height="48" rx="1"/>
                        <path d="M307 92 L312 84 L317 92 Z"/>
                        <rect x="388" y="94" width="10" height="46" rx="1"/>
                        <path d="M393 94 L398 86 L403 94 Z"/>
                        <!-- Central dome and base -->
                        <path d="M330 140 L330 120 A20 20 0 0 1 370 120 L370 140 Z"/>
                        <rect x="322" y="120" width="56" height="20"/>
                        
                        <!-- Maqam Echahid (Martyrs' Memorial) - precise SVG provided by user, scaled and positioned -->
                        <g transform="translate(580,39) scale(0.22)">
                            <path d="M0 0 C1.46986241 2.93972481 1.43285333 5.7850472 1.71875 9.0546875 C1.81295227 10.10162277 1.81295227 10.10162277 1.90905762 11.16970825 C2.10987321 13.40448373 2.30543568 15.63967218 2.5 17.875 C2.69486134 20.10315521 2.89094684 22.33116787 3.09094238 24.55886841 C3.2728138 26.58567314 3.44999766 28.61289687 3.62695312 30.64013672 C3.91254869 33.21236591 4.27079387 35.52836679 5 38 C5.66 37.67515625 6.32 37.3503125 7 37.015625 C10.7056653 35.76110289 14.13678749 35.70723381 18 35.75 C19.04800781 35.73839844 19.04800781 35.73839844 20.1171875 35.7265625 C24.24372354 35.74213433 27.24610358 36.36780065 31 38 C31.48188986 34.06282842 31.96000037 30.12520624 32.4375 26.1875 C32.63956055 24.53717773 32.63956055 24.53717773 32.84570312 22.85351562 C33.59951809 16.62075286 34.26040127 10.39832334 34.73852539 4.13793945 C35 2 35 2 36 0 C38.04190981 0.14238837 40.08352045 0.28907028 42.125 0.4375 C43.83042969 0.55931641 43.83042969 0.55931641 45.5703125 0.68359375 C48.75532567 0.97742754 51.84986047 1.45693914 55 2 C55.00879936 3.51072586 55.00879936 3.51072586 55.01777649 5.05197144 C55.07565799 14.66837598 55.14874119 24.28456839 55.23571491 33.90075493 C55.27993863 38.8413713 55.31929146 43.78191419 55.34643555 48.72265625 C55.46878927 70.31760538 55.6363786 91.61572113 59 113 C59.11356842 113.75200684 59.22713684 114.50401367 59.34414673 115.27880859 C59.9825587 119.47316858 60.71342577 123.64365658 61.5 127.8125 C61.69980469 128.92173828 61.89960938 130.03097656 62.10546875 131.17382812 C62.70709094 134.45592624 63.34323663 137.72851443 64 141 C64.32859009 142.65817749 64.32859009 142.65817749 64.66381836 144.34985352 C66.17978427 151.48698127 68.31438046 157.78650813 71.5625 164.3125 C72.22221802 165.66178589 72.22221802 165.66178589 72.89526367 167.03833008 C77.0580678 175.39434543 81.73658643 183.29498878 87 191 C87.74056641 192.0842627 87.74056641 192.0842627 88.49609375 193.19042969 C103.59812609 215.08084439 121.68999555 235.94160633 143 252 C144.10235426 252.86487721 145.20385798 253.73083916 146.3046875 254.59765625 C165.93714635 269.87084367 187.36278671 282.80364982 209 295 C210.0513916 295.60013916 210.0513916 295.60013916 211.12402344 296.21240234 C218.90870743 300.64106704 226.94149164 304.433286 235.125 308.0625 C235.98810791 308.45018555 236.85121582 308.83787109 237.74047852 309.23730469 C247.66350723 313.54006035 257.61478205 316.53826068 268 320 C268 339.47 268 358.94 268 379 C269.98 379 271.96 379 274 379 C274 387.25 274 395.5 274 404 C105.04 404 -63.92 404 -238 404 C-238 395.75 -238 387.5 -238 379 C-236.02 379 -234.04 379 -232 379 C-232 359.53 -232 340.06 -232 320 C-225.07 317.69 -218.14 315.38 -211 313 C-200.08615455 308.38542105 -189.4267685 303.4033947 -178.8984375 297.97802734 C-177.66339603 297.34176498 -176.42650281 296.70907995 -175.1875 296.08056641 C-150.79976949 283.69282939 -127.21372794 268.26051354 -106 251 C-105.47631836 250.57783203 -104.95263672 250.15566406 -104.41308594 249.72070312 C-89.67868429 237.76819863 -75.33143539 224.25939213 -64 209 C-63.52965332 208.37899414 -63.05930664 207.75798828 -62.57470703 207.11816406 C-53.85562429 195.5776436 -46.07470427 183.61415848 -39 171 C-38.40614502 169.96770264 -38.40614502 169.96770264 -37.80029297 168.91455078 C-26.08715008 148.21808799 -23.73185444 122.26488072 -21 99 C-20.91469528 98.29937943 -20.82939056 97.59875885 -20.74150085 96.87690735 C-19.71492103 87.31466901 -19.77110658 77.71911601 -19.68359375 68.11328125 C-19.66298563 66.20085745 -19.64198825 64.28843781 -19.62062073 62.37602234 C-19.56579802 57.3768351 -19.51621561 52.37760952 -19.46777344 47.37835693 C-19.41726514 42.26327153 -19.36173319 37.14824084 -19.30664062 32.03320312 C-19.19954695 22.02218232 -19.09799657 12.01111371 -19 2 C-16.95928485 1.66089006 -14.91737379 1.32897296 -12.875 1 C-11.73804688 0.814375 -10.60109375 0.62875 -9.4296875 0.4375 C-6.23862398 0.03043951 -3.21182209 -0.07809902 0 0 Z M-17 159 C-16 161 -16 161 -16 161 Z M52 159 C53 161 53 161 53 161 Z M-18 161 C-18.35078613 161.64211426 -18.70157227 162.28422852 -19.06298828 162.94580078 C-36.07280681 193.97342894 -54.6564945 224.15108918 -79 250 C-79.92619141 250.99 -79.92619141 250.99 -80.87109375 252 C-85.34758333 256.63751439 -90.30676448 260.63379108 -95.33291626 264.6572876 C-96.99790128 265.99830964 -98.65101814 267.35283434 -100.30249023 268.71044922 C-109.22069708 276.00059727 -118.44373766 282.60807138 -128.0625 288.9375 C-129.13857513 289.64942505 -129.13857513 289.64942505 -130.23638916 290.37573242 C-150.81295097 303.98069201 -172.01300387 315.86029169 -194 327 C-194 327.33 -194 327.66 -194 328 C-186.10648872 328.2096941 -178.21416427 328.36901754 -170.31854534 328.46630955 C-166.65105141 328.51303663 -162.98547954 328.57626867 -159.3190918 328.67895508 C-155.77218452 328.77765911 -152.22710995 328.83074114 -148.6789341 328.85389519 C-146.68505395 328.87831429 -144.69189921 328.94843057 -142.69914246 329.01966858 C-132.69942383 329.0251485 -128.0226534 325.8522929 -121 319 C-119.36950554 317.68902404 -117.72571897 316.39420163 -116.0625 315.125 C-100.00579932 302.25953717 -84.49609379 287.35807554 -72 271 C-70.86304688 269.60587891 -70.86304688 269.60587891 -69.703125 268.18359375 C-51.39856017 245.3611825 -37.4789668 218.22065729 -27 191 C-26.56606934 189.88367188 -26.13213867 188.76734375 -25.68505859 187.6171875 C-24.25383684 183.91712329 -22.84181365 180.21035475 -21.4375 176.5 C-20.7554248 174.71625977 -20.7554248 174.71625977 -20.05957031 172.89648438 C-19.64674805 171.78595703 -19.23392578 170.67542969 -18.80859375 169.53125 C-18.24869751 168.03948242 -18.24869751 168.03948242 -17.67749023 166.51757812 C-16.72563365 163.90328505 -16.72563365 163.90328505 -18 161 Z M53 161 C54.41428846 168.30715706 56.67863053 175.00817682 59.375 181.9375 C59.81344238 183.06704102 60.25188477 184.19658203 60.70361328 185.36035156 C72.93867932 216.39710848 87.99783623 245.98144639 109 272 C109.4134668 272.51788086 109.82693359 273.03576172 110.25292969 273.56933594 C117.01140828 281.96938196 124.46685963 289.67279582 132.0625 297.3125 C132.97225586 298.231521 133.88201172 299.15054199 134.81933594 300.09741211 C139.99968649 305.2540124 145.26155953 310.18734041 151.06201172 314.64404297 C153.22188796 316.37603613 155.01757365 318.01285984 156.92236328 319.98095703 C166.58307139 329.2690738 177.16123931 329.23176338 189.9286747 329.01576424 C192.72233767 328.9497826 195.51456946 328.85377567 198.30725098 328.75531006 C201.88704747 328.64135802 205.4677285 328.59224743 209.04882812 328.53710938 C216.03468589 328.42027198 223.01708658 328.23336833 230 328 C226.95189092 325.6598421 223.95427302 323.85727647 220.51171875 322.13671875 C219.42463623 321.58701416 218.33755371 321.03730957 217.2175293 320.47094727 C215.47016479 319.58814087 215.47016479 319.58814087 213.6875 318.6875 C188.43895078 305.78351536 164.34772818 290.47439181 142 273 C140.78957031 272.06027344 140.78957031 272.06027344 139.5546875 271.1015625 C124.97577289 259.61656546 111.48080757 247.65763348 100 233 C98.97326172 231.69869141 98.97326172 231.69869141 97.92578125 230.37109375 C81.25784395 208.71201811 67.12863212 184.93023156 54 161 C53.67 161 53.34 161 53 161 Z M-20 230 C-20.27038086 230.60658447 -20.54076172 231.21316895 -20.81933594 231.83813477 C-43.81269578 283.2166335 -74.19278419 331.06895447 -107.7421875 376.19921875 C-109.09543776 377.7705416 -109.09543776 377.7705416 -109 379 C-80.95 379 -52.9 379 -24 379 C-23.87625 367.82125 -23.7525 356.6425 -23.625 345.125 C-23.53933708 338.38653102 -23.45332802 331.64830539 -23.34765625 324.91015625 C-23.32860072 323.69494639 -23.32860072 323.69494639 -23.30916023 322.45518684 C-23.00773999 303.71533459 -22.27399634 285.01816102 -21.13861084 266.31048584 C-20.94149809 263.02483943 -20.75558805 259.73858233 -20.56913757 256.45231628 C-20.06875244 247.63344768 -19.54542285 238.81620785 -19 230 C-19.33 230 -19.66 230 -20 230 Z M55 230 C55.03536362 230.59816528 55.07072723 231.19633057 55.10716248 231.81262207 C55.48285752 238.17441653 55.85559997 244.53637961 56.22680664 250.8984375 C56.36475766 253.2565527 56.50340282 255.61462742 56.64282227 257.97265625 C58.33808052 286.66352514 59.21774855 315.2651274 59.5625 344 C59.706875 355.55 59.85125 367.1 60 379 C88.05 379 116.1 379 145 379 C139.31046841 370.03122205 139.31046841 370.03122205 133.1875 361.5 C103.4909164 321.73342416 74.13682398 276.29445025 56 230 C55.67 230 55.34 230 55 230 Z " transform="translate(238,54)"/>
                        </g>
                        <!-- User-provided Mosque silhouette -->
                        <image href="images/algiers_mosque.svg" x="735" y="30" width="93" height="110" opacity="0.18" />

                        <!-- Great Mosque of Algiers minaret -->
                        <rect x="860" y="60" width="18" height="80" rx="2"/>
                        <rect x="865" y="50" width="8" height="10"/>
                        
                        <!-- Notre Dame d'Afrique dome + body -->
                        <path d="M910 140 L910 110 C910 96 922 84 940 84 C958 84 970 96 970 110 L970 140 Z"/>
                        <rect x="920" y="110" width="40" height="30"/>

                        <!-- Misc buildings to balance skyline -->
                        <rect x="100" y="100" width="30" height="40"/>
                        <rect x="140" y="90" width="20" height="50"/>
                        <rect x="180" y="110" width="26" height="30"/>
                        <rect x="200" y="95" width="28" height="45"/>
                        <rect x="240" y="110" width="22" height="30"/>
                        <rect x="420" y="100" width="28" height="40"/>
                        <rect x="460" y="80" width="30" height="60"/>
                        <rect x="500" y="110" width="22" height="30"/>
                        <rect x="720" y="100" width="28" height="40"/>
                        <rect x="760" y="90" width="24" height="50"/>
                        <rect x="800" y="110" width="26" height="30"/>
                        <rect x="980" y="100" width="30" height="40"/>
                        <rect x="1020" y="110" width="26" height="30"/>
                        <rect x="1060" y="95" width="24" height="45"/>
                    </g>
                </svg>
            </div>
            <!-- Quick Actions: Citymapper-style two badges -->
            <div id="quick-actions" class="quick-actions-panel">
                <button id="action-bus" class="qa-btn" title="Show buses">
                    <div class="qa-icon qa-icon-bus">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="4" y="4" width="16" height="14" rx="2" fill="#0066CC" stroke="white" stroke-width="1.5"/>
                            <rect x="6" y="6" width="12" height="6" fill="#E6F2FF"/>
                            <circle cx="8" cy="16" r="1.5" fill="white"/>
                            <circle cx="16" cy="16" r="1.5" fill="white"/>
                            <line x1="12" y1="6" x2="12" y2="12" stroke="#0066CC" stroke-width="1"/>
                        </svg>
                    </div>
                    <div class="qa-label">Bus</div>
                </button>
                <button id="action-walk" class="qa-btn" title="Walk to stop">
                    <div class="qa-icon qa-icon-walk">
                        <svg width="28" height="28" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M67.9,22.6c5.7,0.4,10.8-3.8,11.3-9.7c0.4-5.7-3.8-10.8-9.7-11.3c-5.7-0.4-10.8,3.8-11.3,9.7C57.8,17.1,62.2,22.2,67.9,22.6" fill="#0066CC" stroke="#ffffff" stroke-width="6"/>
                            <path d="M59,26.9c2-1.5,4.5-2.3,7.3-2.2c3.5,0.3,6.6,2.5,8.3,5.1l10.5,20.9l14.3,10c1.2,1,2,2.5,1.9,4.1c-0.1,2.6-2.5,4.5-5.1,4.2 c-0.7,0-1.5-0.3-2.2-0.7L78.6,57.8c-0.4-0.4-0.9-0.9-1.2-1.5l-4-7.8l-4.7,20.8l18.6,22c0.4,0.7,0.7,1.5,0.9,2.2l5,26.5 c0,0.6,0,1,0,1.5c-0.3,4-3.7,6.7-7.6,6.6c-3.2-0.3-5.6-2.6-6.4-5.6l-4.7-24.7L59.4,81l-3.5,16.1c-0.1,0.7-1.2,2.3-1.5,2.9L40,124.5 c-1.5,2.2-3.8,3.7-6.6,3.4c-4-0.3-6.9-3.7-6.6-7.6c0.1-1.2,0.6-2.2,1-3.1l13.5-22.5L52.5,45l-7.3,5.9l-4,17.7c-0.4,2.2-2.6,4.1-5,4 c-2.6-0.1-4.5-2.5-4.4-5.1c0-0.1,0-0.4,0.1-0.6l4.5-20.6c0.3-0.9,0.7-1.6,1.5-2.2L59,26.9z" fill="#0066CC" stroke="#ffffff" stroke-width="6"/>
                        </svg>
                    </div>
                    <div class="qa-label">Walk</div>
                </button>
            </div>

            <div class="routes-header hidden">
                <h3>Next Arrivals</h3>
                <span class="live-indicator">‚óè Live</span>
            </div>

            <div class="routes-list hidden" id="routes-list">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <!-- Version Footer -->
        <div class="version-footer">
            <div class="version-text">Wsal El Bus 1.10a</div>
            <div class="tagline">Made with ‚ù§Ô∏è for Algiers commuters</div>
        </div>
    </div>

    <!-- Station Selector Modal -->
    <div id="station-modal" class="modal-overlay hidden">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h3>Select Station</h3>
                <button id="close-modal" class="close-btn">‚úï</button>
            </div>
            <input type="text" id="station-search" class="station-search" placeholder="Search stations...">
            <div class="station-list" id="station-list">
                <!-- Station items will be injected here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./leaflet.js"></script>
    <script src="./tile-cache.js"></script>
    <script src="./weather.js"></script>
    <script src="./app.js"></script>

    <!-- Service Worker Registration for Tile Caching -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered for tile caching:', registration.scope);
                        // Force update to get new version
                        registration.update();
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
    </script>

    <!-- Install UI removed -->
</body>

</html>
