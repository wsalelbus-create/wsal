<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Live bus tracker for ETUSA Algiers with real-time countdowns">
    <meta name="theme-color" content="#00d2ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ŸàÿµŸÑ ÿßŸÑÿ®ÿßÿµ">
    <meta name="mobile-web-app-capable" content="yes">

    <title>ŸàÿµŸÑ ÿßŸÑÿ®ÿßÿµ - Wsal El Bus</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.webmanifest">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="./pwa-mobile.css">
    <link rel="stylesheet" href="./station-modal.css">
    <link rel="stylesheet" href="./weather-display.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./leaflet.css" />

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="16x16" href="./images/icon16.png">
    <link rel="icon" type="image/png" sizes="48x48" href="./images/icon48.png">
    <link rel="icon" type="image/png" sizes="128x128" href="./images/icon128.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./images/icon192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./images/icon512.png">
    <link rel="apple-touch-icon" href="./images/icon192.png">
</head>

<body>
    <div class="app-container">
        <header class="glass-header">
            <div class="logo-area">
                <h1 class="arabic-title">ŸàÿµŸÑ ÿßŸÑÿ®ÿßÿµ</h1>
                <button class="settings-badge" id="settings-btn" aria-label="Settings">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M13.9838 2.54161C14.0711 2.71093 14.0928 2.92777 14.1361 3.36144C14.2182 4.1823 14.2593 4.59274 14.4311 4.81793C14.649 5.10358 15.0034 5.25038 15.3595 5.20248C15.6402 5.16472 15.9594 4.90352 16.5979 4.38113C16.9352 4.10515 17.1038 3.96716 17.2853 3.90918C17.5158 3.83555 17.7652 3.84798 17.9872 3.94419C18.162 4.01994 18.3161 4.17402 18.6243 4.4822L19.5178 5.37567C19.8259 5.68385 19.98 5.83794 20.0558 6.01275C20.152 6.23478 20.1644 6.48415 20.0908 6.71464C20.0328 6.89612 19.8948 7.06478 19.6188 7.4021C19.0964 8.0406 18.8352 8.35984 18.7975 8.64056C18.7496 8.99662 18.8964 9.35102 19.182 9.56893C19.4072 9.74072 19.8176 9.78176 20.6385 9.86385C21.0722 9.90722 21.2891 9.92891 21.4584 10.0162C21.6734 10.1272 21.841 10.3123 21.9299 10.5373C22 10.7145 22 10.9324 22 11.3682V12.6319C22 13.0676 22 13.2855 21.93 13.4626C21.841 13.6877 21.6734 13.8729 21.4583 13.9838C21.289 14.0711 21.0722 14.0928 20.6386 14.1361L20.6386 14.1361C19.818 14.2182 19.4077 14.2592 19.1825 14.4309C18.8967 14.6489 18.7499 15.0034 18.7979 15.3596C18.8357 15.6402 19.0968 15.9593 19.619 16.5976C19.8949 16.9348 20.0328 17.1034 20.0908 17.2848C20.1645 17.5154 20.152 17.7648 20.0558 17.9869C19.98 18.1617 19.826 18.3157 19.5179 18.6238L18.6243 19.5174C18.3162 19.8255 18.1621 19.9796 17.9873 20.0554C17.7652 20.1516 17.5159 20.164 17.2854 20.0904C17.1039 20.0324 16.9352 19.8944 16.5979 19.6184L16.5979 19.6184C15.9594 19.096 15.6402 18.8348 15.3595 18.7971C15.0034 18.7492 14.649 18.896 14.4311 19.1816C14.2593 19.4068 14.2183 19.8173 14.1362 20.6383C14.0928 21.0722 14.0711 21.2891 13.9837 21.4585C13.8728 21.6735 13.6877 21.8409 13.4628 21.9299C13.2856 22 13.0676 22 12.6316 22H11.3682C10.9324 22 10.7145 22 10.5373 21.9299C10.3123 21.841 10.1272 21.6734 10.0162 21.4584C9.92891 21.2891 9.90722 21.0722 9.86385 20.6385C9.78176 19.8176 9.74072 19.4072 9.56892 19.182C9.35101 18.8964 8.99663 18.7496 8.64057 18.7975C8.35985 18.8352 8.04059 19.0964 7.40208 19.6189L7.40206 19.6189C7.06473 19.8949 6.89607 20.0329 6.71458 20.0908C6.4841 20.1645 6.23474 20.152 6.01272 20.0558C5.8379 19.9801 5.6838 19.826 5.37561 19.5178L4.48217 18.6243C4.17398 18.3162 4.01988 18.1621 3.94414 17.9873C3.84794 17.7652 3.8355 17.5159 3.90913 17.2854C3.96711 17.1039 4.10511 16.9352 4.3811 16.5979C4.90351 15.9594 5.16471 15.6402 5.20247 15.3594C5.25037 15.0034 5.10357 14.649 4.81792 14.4311C4.59273 14.2593 4.1823 14.2182 3.36143 14.1361C2.92776 14.0928 2.71093 14.0711 2.54161 13.9838C2.32656 13.8728 2.15902 13.6877 2.07005 13.4627C2 13.2855 2 13.0676 2 12.6318V11.3683C2 10.9324 2 10.7144 2.07008 10.5372C2.15905 10.3123 2.32654 10.1272 2.54152 10.0163C2.71088 9.92891 2.92777 9.90722 3.36155 9.86384H3.36155H3.36156C4.18264 9.78173 4.59319 9.74068 4.81842 9.56881C5.10395 9.35092 5.2507 8.99664 5.20287 8.64066C5.16514 8.35987 4.90385 8.04052 4.38128 7.40182C4.10516 7.06435 3.96711 6.89561 3.90914 6.71405C3.83557 6.48364 3.848 6.23438 3.94413 6.01243C4.01988 5.83754 4.17403 5.68339 4.48233 5.37509L5.37565 4.48177L5.37566 4.48177C5.68385 4.17357 5.83795 4.01947 6.01277 3.94373C6.23478 3.84753 6.48414 3.8351 6.71463 3.90872C6.89612 3.9667 7.06481 4.10472 7.4022 4.38076C8.04061 4.9031 8.35982 5.16427 8.64044 5.20207C8.99661 5.25003 9.35113 5.10319 9.56907 4.81742C9.74077 4.59227 9.78181 4.18195 9.86387 3.36131C9.90722 2.92776 9.9289 2.71098 10.0162 2.5417C10.1271 2.32658 10.3123 2.15898 10.5374 2.07001C10.7145 2 10.9324 2 11.3681 2H12.6318C13.0676 2 13.2855 2 13.4627 2.07005C13.6877 2.15902 13.8728 2.32656 13.9838 2.54161ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
            <div class="time-display" id="algiers-time" style="display: none;">--:--</div>
        </header>

        <!-- Fixed Back Badge (outside map container to avoid stacking under arrivals) -->
        <button class="back-badge hidden" id="back-btn" aria-label="Back to home">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 6L9 12L15 18" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <!-- Map View (Top 60%) -->
        <div id="map-view" class="map-view-container">
            <div id="map-container"></div>
            <!-- Hidden element for JS compatibility -->
            <p id="map-distance" style="display: none;"></p>
        </div>

        <!-- Walking Time Badge (floating above map) -->
        <div class="walking-time-badge hidden" id="walking-time">
            <svg class="walk-icon" width="20" height="20" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M67.9,22.6c5.7,0.4,10.8-3.8,11.3-9.7c0.4-5.7-3.8-10.8-9.7-11.3c-5.7-0.4-10.8,3.8-11.3,9.7C57.8,17.1,62.2,22.2,67.9,22.6" fill="currentColor"/>
                <path d="M59,26.9c2-1.5,4.5-2.3,7.3-2.2c3.5,0.3,6.6,2.5,8.3,5.1l10.5,20.9l14.3,10c1.2,1,2,2.5,1.9,4.1c-0.1,2.6-2.5,4.5-5.1,4.2 c-0.7,0-1.5-0.3-2.2-0.7L78.6,57.8c-0.4-0.4-0.9-0.9-1.2-1.5l-4-7.8l-4.7,20.8l18.6,22c0.4,0.7,0.7,1.5,0.9,2.2l5,26.5 c0,0.6,0,1,0,1.5c-0.3,4-3.7,6.7-7.6,6.6c-3.2-0.3-5.6-2.6-6.4-5.6l-4.7-24.7L59.4,81l-3.5,16.1c-0.1,0.7-1.2,2.3-1.5,2.9L40,124.5 c-1.5,2.2-3.8,3.7-6.6,3.4c-4-0.3-6.9-3.7-6.6-7.6c0.1-1.2,0.6-2.2,1-3.1l13.5-22.5L52.5,45l-7.3,5.9l-4,17.7c-0.4,2.2-2.6,4.1-5,4 c-2.6-0.1-4.5-2.5-4.4-5.1c0-0.1,0-0.4,0.1-0.6l4.5-20.6c0.3-0.9,0.7-1.6,1.5-2.2L59,26.9z" fill="currentColor"/>
            </svg>
            <span id="walk-time-text">Calculating...</span>
        </div>

        <!-- Map Controls Stack (below walking badge) -->
        <div class="map-controls-stack">
            <!-- Calorie Badge (appears in Walk mode) -->
            <div class="calorie-badge hidden" id="calorie-badge" title="Calories for this walk">
                <span id="calorie-text">‚Äî / Kcal</span>
            </div>
            <!-- Location Button -->
            <button class="map-control-btn" id="locate-btn" title="Center on my location">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="3" fill="currentColor" />
                    <path d="M12 2V6M12 18V22M22 12H18M6 12H2" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                </svg>
            </button>

            <!-- Compass Button -->
            <button class="map-control-btn" id="compass-btn" title="North indicator">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L15 10L12 8L9 10L12 2Z" fill="#FF0055" />
                    <path d="M12 22L9 14L12 16L15 14L12 22Z" fill="#666" />
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none" />
                </svg>
                <span class="compass-label">N</span>
            </button>
        </div>

        <!-- Floating Station Control (Middle Overlap) -->
        <div id="floating-controls" class="floating-controls">
            <div class="station-selector-card" id="station-selector-trigger">
                <div class="station-info-left">
                    <span class="station-icon">üöè</span>
                    <div class="station-text-group">
                        <h2 id="station-name">Loading...</h2>
                        <div class="station-subtext">Tap to change station</div>
                    </div>
                </div>
                <div class="station-select-icon">‚ãÆ</div>
            </div>
        </div>

        <!-- Arrivals Panel (Bottom 40%) -->
        <div id="arrivals-panel" class="arrivals-panel panel-green">
            <!-- Algiers Skyline Backdrop (bottom-anchored) -->
            <div id="skyline-inline" class="skyline-inline" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 140" preserveAspectRatio="xMidYMax slice">
                  <path d="M 193.912 140 L 193.912 105.662 L 219.004 105.662 L 219.004 79.908 L 237.824 79.908 L 237.824 97.077 L 262.916 97.077 L 262.916 54.154 L 288.009 54.154 L 288.009 88.492 L 313.101 88.492 L 313.101 62.739 L 338.194 62.739 L 338.194 36.985 L 357.013 36.985 L 357.013 97.077 L 382.106 97.077 L 382.106 71.323 L 407.198 71.323 L 407.198 106.345 L 409.758 135.022 L 407.027 106.337 L 428.707 106.338 L 428.707 135.996 L 535.05 137.361 L 533.001 136.188 L 534.197 136.188 L 533.514 136.387 L 532.66 105.662 L 532.66 54.154 L 557.753 54.154 L 557.753 105.662 L 582.845 105.662 L 582.845 71.323 L 607.938 71.323 L 607.938 97.077 L 607.767 96.394 L 609.132 139.212 L 650.613 139.893 L 709.333 140.485 L 709.161 88.592 L 708.478 88.976 L 708.991 88.293 L 708.308 88.492 L 733.4 88.492 L 733.4 45.569 L 758.493 45.569 L 758.493 97.077 L 783.585 97.077 L 783.585 71.323 L 808.678 71.323 L 808.678 105.662 L 833.77 105.662 L 833.77 54.154 L 858.863 54.154 L 858.863 105.662 L 883.955 105.662 L 883.955 79.908 L 909.048 79.908 L 909.048 105.662 L 946.687 105.662 L 946.687 140 L 193.912 140 Z" fill="rgba(0,0,0,0.26)"/>
                  <g transform="matrix(0.22, 0, 0, 0.338298, 946.340041, -13.814955)" fill="rgba(0,0,0,0.26)">
                    <path d="M -1326.2 62.073 C -1324.7 64.939 -1324.8 67.713 -1324.5 70.901 C -1324.4 71.922 -1324.4 71.922 -1324.3 72.963 C -1324.1 75.142 -1323.9 77.321 -1323.7 79.501 C -1323.5 81.674 -1323.3 83.846 -1323.1 86.019 C -1322.9 87.994 -1322.8 89.971 -1322.6 91.948 C -1322.3 94.455 -1321.9 96.714 -1321.2 99.124 C -1320.5 98.807 -1319.9 98.49 -1319.2 98.163 C -1315.5 96.941 -1312.1 96.888 -1308.2 96.93 C -1307.2 96.918 -1307.2 96.918 -1306.1 96.907 C -1302 96.922 -1299 97.532 -1295.2 99.124 C -1294.7 95.285 -1294.2 91.445 -1293.8 87.606 C -1293.6 85.997 -1293.6 85.997 -1293.4 84.355 C -1292.6 78.278 -1291.9 72.211 -1291.5 66.108 C -1291.2 64.023 -1291.2 64.023 -1290.2 62.073 C -1288.2 62.211 -1286.1 62.355 -1284.1 62.499 C -1282.4 62.618 -1282.4 62.618 -1280.6 62.739 C -1277.5 63.026 -1274.4 63.494 -1271.2 64.023 C -1271.2 65.495 -1271.2 65.495 -1271.2 66.999 C -1271.1 76.375 -1271.1 85.75 -1271 95.126 C -1270.9 99.944 -1270.9 104.761 -1270.9 109.578 C -1270.7 130.634 -1270.6 151.4 -1267.2 172.25 C -1267.1 172.984 -1267 173.717 -1266.9 174.472 C -1266.2 178.562 -1265.5 182.628 -1264.7 186.693 C -1264.5 187.774 -1264.3 188.856 -1264.1 189.971 C -1263.5 193.171 -1262.9 196.361 -1262.2 199.551 C -1261.9 201.168 -1261.9 201.168 -1261.5 202.817 C -1260 209.776 -1257.9 215.918 -1254.6 222.281 C -1254 223.596 -1254 223.596 -1253.3 224.939 C -1249.1 233.086 -1244.5 240.79 -1239.2 248.302 C -1238.5 249.359 -1238.5 249.359 -1237.7 250.438 C -1222.6 271.782 -1204.5 292.121 -1183.2 307.779 C -1182.1 308.622 -1181 309.466 -1179.9 310.311 C -1160.3 325.203 -1138.8 337.812 -1117.2 349.705 C -1116.2 350.29 -1116.2 350.29 -1115.1 350.886 C -1107.3 355.205 -1099.3 358.902 -1091.1 362.44 C -1090.2 362.819 -1089.4 363.197 -1088.5 363.586 C -1078.5 367.782 -1068.6 370.705 -1058.2 374.08 C -1058.2 393.064 -1058.2 412.048 -1058.2 431.606 C -1056.2 431.606 -1054.2 431.606 -1052.2 431.606 C -1052.2 439.65 -1052.2 447.694 -1052.2 455.982 C -1221.2 455.982 -1390.1 455.982 -1564.2 455.982 C -1564.2 447.938 -1564.2 439.894 -1564.2 431.606 C -1562.2 431.606 -1560.2 431.606 -1558.2 431.606 C -1558.2 412.623 -1558.2 393.639 -1558.2 374.08 C -1551.3 371.828 -1544.3 369.576 -1537.2 367.255 C -1526.3 362.755 -1515.6 357.898 -1505.1 352.608 C -1503.9 351.987 -1502.6 351.371 -1501.4 350.758 C -1477 338.68 -1453.4 323.632 -1432.2 306.804 C -1431.7 306.392 -1431.2 305.98 -1430.6 305.556 C -1415.9 293.902 -1401.5 280.731 -1390.2 265.853 C -1389.7 265.247 -1389.3 264.642 -1388.8 264.018 C -1380.1 252.765 -1372.3 241.101 -1365.2 228.802 C -1364.6 227.795 -1364.6 227.795 -1364 226.768 C -1352.3 206.589 -1349.9 181.284 -1347.2 158.6 C -1347.1 157.917 -1347 157.233 -1346.9 156.53 C -1345.9 147.206 -1346 137.851 -1345.9 128.485 C -1345.9 126.62 -1345.8 124.755 -1345.8 122.891 C -1345.8 118.017 -1345.7 113.142 -1345.7 108.268 C -1345.6 103.28 -1345.6 98.293 -1345.5 93.306 C -1345.4 83.545 -1345.3 73.784 -1345.2 64.023 C -1343.2 63.692 -1341.1 63.369 -1339.1 63.048 C -1337.9 62.867 -1336.8 62.685 -1335.6 62.499 C -1332.4 62.102 -1329.4 61.997 -1326.2 62.073 Z M -1343.2 217.102 C -1342.2 219.052 -1342.2 219.052 -1342.2 219.052 L -1343.2 217.102 Z M -1274.2 217.102 C -1273.2 219.052 -1273.2 219.052 -1273.2 219.052 L -1274.2 217.102 Z M -1344.2 219.052 C -1344.6 219.678 -1344.9 220.303 -1345.3 220.948 C -1362.3 251.201 -1380.9 280.625 -1405.2 305.829 C -1406.1 306.794 -1406.1 306.794 -1407.1 307.779 C -1411.6 312.3 -1416.5 316.196 -1421.5 320.119 C -1423.2 321.427 -1424.9 322.748 -1426.5 324.071 C -1435.4 331.179 -1444.6 337.622 -1454.3 343.793 C -1455.3 344.487 -1455.3 344.487 -1456.4 345.195 C -1477 358.46 -1498.2 370.044 -1520.2 380.905 C -1520.2 381.227 -1520.2 381.549 -1520.2 381.88 C -1512.3 382.084 -1504.4 382.24 -1496.5 382.335 C -1492.9 382.381 -1489.2 382.442 -1485.5 382.542 C -1482 382.638 -1478.4 382.69 -1474.9 382.713 C -1472.9 382.736 -1470.9 382.805 -1468.9 382.874 C -1458.9 382.88 -1454.2 379.786 -1447.2 373.105 C -1445.6 371.827 -1443.9 370.564 -1442.3 369.327 C -1426.2 356.782 -1410.7 342.253 -1398.2 326.304 C -1397.1 324.945 -1397.1 324.945 -1395.9 323.557 C -1377.6 301.305 -1363.7 274.842 -1353.2 248.302 C -1352.8 247.213 -1352.3 246.125 -1351.9 245.004 C -1350.5 241.396 -1349 237.782 -1347.6 234.164 C -1347 232.425 -1347 232.425 -1346.3 230.65 C -1345.9 229.568 -1345.4 228.485 -1345 227.369 C -1344.5 225.915 -1344.5 225.915 -1343.9 224.431 C -1342.9 221.882 -1342.9 221.882 -1344.2 219.052 Z M -1273.2 219.052 C -1271.8 226.176 -1269.5 232.71 -1266.8 239.466 C -1266.4 240.567 -1266 241.668 -1265.5 242.803 C -1253.3 273.065 -1238.2 301.91 -1217.2 327.279 C -1216.8 327.784 -1216.4 328.288 -1216 328.809 C -1209.2 336.999 -1201.7 344.51 -1194.1 351.959 C -1193.2 352.855 -1192.3 353.751 -1191.4 354.674 C -1186.2 359.702 -1180.9 364.512 -1175.1 368.858 C -1173 370.547 -1171.2 372.143 -1169.3 374.062 C -1159.6 383.118 -1149 383.081 -1136.3 382.87 C -1133.5 382.806 -1130.7 382.712 -1127.9 382.616 C -1124.3 382.505 -1120.7 382.458 -1117.2 382.404 C -1110.2 382.29 -1103.2 382.108 -1096.2 381.88 C -1099.3 379.599 -1102.3 377.841 -1105.7 376.163 C -1106.8 375.628 -1107.9 375.091 -1109 374.539 C -1110.7 373.678 -1110.7 373.678 -1112.5 372.8 C -1137.8 360.218 -1161.9 345.292 -1184.2 328.254 C -1185.4 327.338 -1185.4 327.338 -1186.7 326.403 C -1201.2 315.204 -1214.7 303.544 -1226.2 289.253 C -1227.2 287.984 -1227.2 287.984 -1228.3 286.69 C -1244.9 265.572 -1259.1 242.384 -1272.2 219.052 C -1272.5 219.052 -1272.9 219.052 -1273.2 219.052 Z M -1346.2 286.328 C -1346.5 286.919 -1346.7 287.511 -1347 288.12 C -1370 338.215 -1400.4 384.873 -1433.9 428.875 C -1435.3 430.407 -1435.3 430.407 -1435.2 431.606 C -1407.2 431.606 -1379.1 431.606 -1350.2 431.606 C -1350.1 420.707 -1350 409.807 -1349.8 398.578 C -1349.7 392.007 -1349.7 385.437 -1349.6 378.868 C -1349.5 377.683 -1349.5 377.683 -1349.5 376.474 C -1349.2 358.202 -1348.5 339.972 -1347.3 321.731 C -1347.1 318.528 -1347 315.323 -1346.8 312.119 C -1346.3 303.521 -1345.8 294.924 -1345.2 286.328 C -1345.5 286.328 -1345.9 286.328 -1346.2 286.328 Z M -1271.2 286.328 C -1271.2 286.911 -1271.1 287.494 -1271.1 288.095 C -1270.7 294.298 -1270.3 300.501 -1270 306.704 C -1269.8 309.003 -1269.7 311.302 -1269.6 313.601 C -1267.9 341.576 -1267 369.463 -1266.6 397.481 C -1266.5 408.742 -1266.4 420.004 -1266.2 431.606 C -1238.2 431.606 -1210.1 431.606 -1181.2 431.606 C -1186.9 422.862 -1186.9 422.862 -1193 414.544 C -1222.7 375.77 -1252.1 331.466 -1270.2 286.328 C -1270.5 286.328 -1270.9 286.328 -1271.2 286.328 Z"/>
                  </g>
                  <g transform="matrix(0.22, 0, 0, 0.217604, 55.547624, 13.988505)" fill="rgba(0,0,0,0.26)">
                    <path d="M 1770.45 5.948 C 1771.11 5.948 1771.77 5.948 1772.45 5.948 C 1774.96 17.897 1777.44 29.851 1779.88 41.812 C 1781.02 47.369 1782.17 52.923 1783.34 58.474 C 1792.85 103.764 1792.85 103.764 1791.45 125.948 C 1798.38 125.948 1805.31 125.948 1812.45 125.948 C 1810.8 130.087 1809.51 132.454 1806.89 135.886 C 1803.11 140.939 1799.71 146.147 1796.42 151.528 C 1795.48 153.034 1794.47 154.496 1793.45 155.948 C 1792.79 155.948 1792.13 155.948 1791.45 155.948 C 1791.45 179.048 1791.45 202.148 1791.45 225.948 C 1798.38 225.948 1805.31 225.948 1812.45 225.948 C 1810.8 230.087 1809.51 232.454 1806.89 235.886 C 1803.11 240.939 1799.71 246.147 1796.42 251.528 C 1795.48 253.034 1794.47 254.496 1793.45 255.948 C 1792.79 255.948 1792.13 255.948 1791.45 255.948 C 1791.23 265.982 1791.1 276.013 1791.07 286.049 C 1791.05 290.712 1791 295.371 1790.89 300.033 C 1790.35 324.019 1791.04 340.123 1807.45 358.948 C 1810.33 362.584 1811.96 365.37 1811.84 370.128 C 1811.83 370.966 1811.82 371.803 1811.81 372.666 C 1811.78 373.708 1811.74 374.75 1811.7 375.823 C 1811.62 379.164 1811.54 382.506 1811.45 385.948 C 1824.65 385.948 1837.85 385.948 1851.45 385.948 C 1851.45 366.148 1851.45 346.348 1851.45 325.948 C 1858.05 325.948 1864.65 325.948 1871.45 325.948 C 1871.54 324.608 1871.62 323.267 1871.7 321.886 C 1874.69 293.788 1890.94 270.247 1911.81 252.03 C 1916.72 248.157 1921.99 244.984 1927.45 241.948 C 1928.05 241.609 1928.65 241.27 1929.27 240.92 C 1944.92 232.203 1963.38 225.685 1981.45 225.948 C 1981.35 224.633 1981.24 223.318 1981.14 221.964 C 1980.12 202.351 1985.17 184.655 1990.45 165.948 C 1991.11 165.948 1991.77 165.948 1992.45 165.948 C 1998.16 186.146 2003.13 204.769 2001.45 225.948 C 2002.17 225.962 2002.89 225.977 2003.63 225.991 C 2031.77 227.288 2057.93 240.19 2078.45 258.948 C 2079.2 259.626 2079.95 260.304 2080.72 261.003 C 2097.34 276.799 2108.5 299.209 2111.45 321.948 C 2111.45 323.268 2111.45 324.588 2111.45 325.948 C 2118.05 325.948 2124.65 325.948 2131.45 325.948 C 2131.45 345.748 2131.45 365.548 2131.45 385.948 C 2144.65 385.948 2157.85 385.948 2171.45 385.948 C 2171.45 448.648 2171.45 511.348 2171.45 575.948 C 2013.05 575.948 1854.65 575.948 1691.45 575.948 C 1691.45 513.248 1691.45 450.548 1691.45 385.948 C 1704.65 385.948 1717.85 385.948 1731.45 385.948 C 1731.18 382.896 1730.92 379.843 1730.64 376.698 C 1730.18 364.556 1735.31 356.781 1742.58 347.473 C 1743.51 346.223 1743.51 346.223 1744.45 344.948 C 1744.95 344.404 1745.45 343.86 1745.97 343.299 C 1752.13 335.771 1751.4 327.067 1751.39 317.843 C 1751.4 316.073 1751.42 314.303 1751.44 312.534 C 1751.46 308.833 1751.47 305.132 1751.45 301.431 C 1751.44 296.724 1751.5 292.021 1751.58 287.315 C 1751.64 283.661 1751.64 280.007 1751.63 276.353 C 1751.64 274.62 1751.66 272.887 1751.69 271.154 C 1751.94 257.979 1749 250.891 1740.45 240.948 C 1739.44 239.502 1738.45 238.042 1737.51 236.554 C 1737.13 235.972 1736.76 235.39 1736.37 234.79 C 1736.03 234.244 1735.68 233.698 1735.33 233.136 C 1734.94 232.539 1734.56 231.943 1734.16 231.329 C 1731.45 227.083 1731.45 227.083 1731.45 225.948 C 1738.05 225.948 1744.65 225.948 1751.45 225.948 C 1751.55 216.932 1751.6 207.918 1751.58 198.902 C 1751.57 194.713 1751.58 190.527 1751.63 186.339 C 1751.68 182.285 1751.68 178.235 1751.65 174.181 C 1751.65 172.647 1751.66 171.112 1751.69 169.577 C 1751.94 157.072 1748.41 150.425 1740.45 140.948 C 1739.45 139.5 1738.45 138.04 1737.51 136.554 C 1737.13 135.972 1736.76 135.39 1736.37 134.79 C 1736.03 134.244 1735.68 133.698 1735.33 133.136 C 1734.94 132.539 1734.56 131.943 1734.16 131.329 C 1731.45 127.083 1731.45 127.083 1731.45 125.948 C 1738.05 125.948 1744.65 125.948 1751.45 125.948 C 1751.16 121.279 1751.16 121.279 1750.86 116.515 C 1750.42 95.815 1756.03 75.317 1760.26 55.193 C 1761.42 49.631 1762.56 44.064 1763.7 38.497 C 1765.92 27.642 1768.18 16.793 1770.45 5.948 Z M 1873.26 362.448 C 1870.81 367.198 1871.01 371.07 1871.2 376.323 C 1871.22 377.25 1871.24 378.177 1871.26 379.132 C 1871.3 381.405 1871.37 383.676 1871.45 385.948 C 1875.56 385.973 1879.68 385.991 1883.79 386.003 C 1885.19 386.008 1886.59 386.015 1887.99 386.024 C 1889.99 386.036 1892 386.041 1894.01 386.046 C 1895.22 386.051 1896.43 386.056 1897.68 386.062 C 1900.36 386.266 1900.36 386.266 1901.45 384.948 C 1901.63 382.038 1901.73 379.173 1901.77 376.261 C 1901.81 375.055 1901.81 375.055 1901.85 373.825 C 1901.91 368.349 1901.08 365.295 1897.45 360.948 C 1893.75 357.608 1891.22 356.118 1886.2 355.636 C 1880.38 356.121 1877.09 358.082 1873.26 362.448 Z M 1914.73 362.979 C 1912.83 367.39 1913.13 371.521 1913.27 376.261 C 1913.33 379.458 1913.39 382.654 1913.45 385.948 C 1923.35 385.948 1933.25 385.948 1943.45 385.948 C 1944.92 372.685 1944.92 372.685 1940.27 360.823 C 1936.36 357.49 1933.22 356.181 1928.14 355.511 C 1922.48 356.182 1918.41 358.644 1914.73 362.979 Z M 1956.49 364.044 C 1954.41 367.866 1954.94 372.093 1955.14 376.323 C 1955.24 379.499 1955.35 382.676 1955.45 385.948 C 1965.35 385.948 1975.25 385.948 1985.45 385.948 C 1986.93 372.659 1986.93 372.659 1982.2 360.823 C 1977.99 357.057 1974.21 355.465 1968.47 355.636 C 1963.44 356.415 1959.62 360.225 1956.49 364.044 Z M 1998.49 364.044 C 1996.41 367.866 1996.94 372.093 1997.14 376.323 C 1997.24 379.499 1997.35 382.676 1997.45 385.948 C 2007.35 385.948 2017.25 385.948 2027.45 385.948 C 2028.93 372.659 2028.93 372.659 2024.2 360.823 C 2019.99 357.057 2016.21 355.465 2010.47 355.636 C 2005.44 356.415 2001.62 360.225 1998.49 364.044 Z M 2040.71 363.802 C 2038.37 367.79 2038.83 371.899 2039.08 376.386 C 2039.2 379.541 2039.33 382.697 2039.45 385.948 C 2049.35 385.948 2059.25 385.948 2069.45 385.948 C 2069.53 382.772 2069.62 379.596 2069.7 376.323 C 2069.76 374.839 2069.76 374.839 2069.81 373.325 C 2069.88 367.686 2069.32 364.359 2065.45 359.948 C 2062.22 357.129 2059.13 356.031 2054.89 355.511 C 2048.56 356.316 2044.72 359.026 2040.71 363.802 Z M 2084.64 362.011 C 2082.09 365.433 2081.33 366.9 2081.32 371.046 C 2081.32 371.847 2081.32 372.648 2081.32 373.474 C 2081.32 374.311 2081.32 375.148 2081.33 376.011 C 2081.32 376.852 2081.32 377.693 2081.32 378.559 C 2080.92 382.572 2080.92 382.572 2082.45 385.948 C 2084.6 386.036 2086.75 386.055 2088.89 386.046 C 2090.2 386.043 2091.5 386.039 2092.85 386.036 C 2094.24 386.028 2095.63 386.019 2097.01 386.011 C 2098.41 386.006 2099.8 386.001 2101.19 385.997 C 2104.61 385.985 2108.03 385.969 2111.45 385.948 C 2111.6 382.761 2111.69 379.575 2111.76 376.386 C 2111.81 375.49 2111.85 374.595 2111.89 373.673 C 2112.01 367.07 2110.88 363.888 2106.45 358.948 C 2098.75 353.759 2090.62 355.002 2084.64 362.011 Z M 1724.45 482.948 C 1723.56 483.735 1723.56 483.735 1722.65 484.538 C 1716.38 490.444 1710.21 496.923 1709.64 505.841 C 1709.64 507.982 1709.67 510.124 1709.73 512.265 C 1709.74 513.402 1709.75 514.54 1709.76 515.712 C 1709.79 519.313 1709.87 522.911 1709.95 526.511 C 1709.98 528.962 1710 531.413 1710.02 533.864 C 1710.07 538.317 1710.13 542.768 1710.23 547.22 C 1710.25 548.111 1710.27 549.003 1710.29 549.921 C 1710.23 551.943 1710.23 551.943 1711.45 552.948 C 1713.91 553.048 1716.34 553.084 1718.8 553.078 C 1719.57 553.079 1720.34 553.081 1721.13 553.083 C 1723.69 553.087 1726.24 553.084 1728.8 553.081 C 1730.56 553.082 1732.33 553.083 1734.1 553.084 C 1737.81 553.085 1741.52 553.083 1745.22 553.079 C 1749.99 553.073 1754.76 553.076 1759.52 553.082 C 1763.17 553.086 1766.82 553.085 1770.47 553.082 C 1772.23 553.081 1773.99 553.082 1775.75 553.084 C 1778.2 553.087 1780.65 553.083 1783.1 553.078 C 1784.2 553.081 1784.2 553.081 1785.33 553.084 C 1788.67 553.364 1788.67 553.364 1791.45 551.948 C 1791.59 550.417 1791.65 548.88 1791.69 547.343 C 1791.72 546.361 1791.74 545.379 1791.77 544.367 C 1791.86 539.826 1791.92 535.284 1791.97 530.742 C 1792 528.357 1792.05 525.972 1792.11 523.588 C 1793.04 506.194 1793.04 506.194 1785.6 491.129 C 1784.89 490.409 1784.18 489.689 1783.45 488.948 C 1782.71 488.092 1781.97 487.235 1781.2 486.353 C 1774.58 478.809 1765.26 473.442 1755.17 472.71 C 1742.98 472.47 1733.73 474.738 1724.45 482.948 Z M 1839.77 487.823 C 1838.65 489.192 1837.55 490.568 1836.45 491.948 C 1835.92 492.595 1835.39 493.241 1834.84 493.907 C 1830.16 500.124 1829.62 505.052 1829.8 512.694 C 1829.8 513.787 1829.8 514.879 1829.81 516.004 C 1829.82 518.296 1829.85 520.588 1829.89 522.88 C 1829.95 526.4 1829.97 529.918 1829.98 533.438 C 1830 535.67 1830.02 537.901 1830.05 540.132 C 1830.06 541.187 1830.06 542.242 1830.07 543.329 C 1830.09 544.301 1830.11 545.273 1830.13 546.274 C 1830.14 547.131 1830.16 547.987 1830.17 548.87 C 1830.27 551.168 1830.27 551.168 1832.45 552.948 C 1834.95 553.141 1837.33 553.211 1839.82 553.191 C 1840.58 553.193 1841.34 553.195 1842.13 553.197 C 1844.64 553.201 1847.16 553.19 1849.67 553.179 C 1851.42 553.177 1853.16 553.177 1854.91 553.177 C 1858.56 553.176 1862.22 553.167 1865.87 553.154 C 1870.57 553.137 1875.27 553.133 1879.96 553.134 C 1883.56 553.134 1887.16 553.128 1890.77 553.121 C 1892.5 553.118 1894.23 553.116 1895.96 553.115 C 1898.38 553.113 1900.79 553.104 1903.21 553.093 C 1903.93 553.094 1904.66 553.094 1905.4 553.095 C 1908.71 553.36 1908.71 553.36 1911.45 551.948 C 1911.59 550.381 1911.65 548.808 1911.69 547.236 C 1911.73 545.728 1911.73 545.728 1911.77 544.189 C 1911.86 539.546 1911.92 534.903 1911.97 530.26 C 1912 527.82 1912.05 525.38 1912.11 522.94 C 1913.15 507.236 1913.15 507.236 1907.67 493.097 C 1906.31 491.672 1904.9 490.286 1903.45 488.948 C 1902.12 487.285 1900.78 485.619 1899.45 483.948 C 1889.66 475.682 1880.14 472.001 1867.36 472.569 C 1855.76 473.694 1847.47 479.354 1839.77 487.823 Z M 1959.38 488.546 C 1957.67 490.976 1956.06 493.446 1954.45 495.948 C 1953.93 496.548 1953.42 497.148 1952.88 497.766 C 1951.13 500.444 1951.08 501.978 1951.1 505.16 C 1951.09 506.197 1951.09 507.235 1951.09 508.304 C 1951.1 509.418 1951.11 510.531 1951.12 511.679 C 1951.13 512.825 1951.13 513.971 1951.13 515.152 C 1951.14 517.572 1951.15 519.992 1951.17 522.412 C 1951.2 526.132 1951.21 529.851 1951.22 533.571 C 1951.23 535.92 1951.24 538.268 1951.25 540.616 C 1951.25 541.736 1951.26 542.856 1951.26 544.009 C 1951.27 545.037 1951.28 546.065 1951.29 547.125 C 1951.3 548.034 1951.31 548.944 1951.31 549.881 C 1951.22 551.939 1951.22 551.939 1952.45 552.948 C 1954.88 553.054 1957.27 553.095 1959.69 553.093 C 1960.45 553.097 1961.21 553.1 1961.99 553.104 C 1964.51 553.113 1967.03 553.115 1969.54 553.116 C 1971.29 553.119 1973.03 553.123 1974.77 553.126 C 1978.43 553.132 1982.09 553.134 1985.74 553.133 C 1990.44 553.133 1995.13 553.147 1999.83 553.164 C 2003.43 553.175 2007.03 553.177 2010.63 553.177 C 2012.36 553.178 2014.1 553.182 2015.83 553.19 C 2018.24 553.2 2020.66 553.197 2023.08 553.191 C 2024.16 553.2 2024.16 553.2 2025.27 553.208 C 2029.31 553.298 2029.31 553.298 2032.45 550.948 C 2032.79 548.798 2032.79 548.798 2032.79 546.29 C 2032.81 545.321 2032.84 544.353 2032.86 543.355 C 2032.87 542.303 2032.88 541.251 2032.89 540.167 C 2032.91 539.084 2032.92 538 2032.93 536.884 C 2032.96 534.584 2032.98 532.284 2032.99 529.984 C 2033.01 526.489 2033.09 522.997 2033.16 519.503 C 2033.18 517.266 2033.2 515.029 2033.21 512.792 C 2033.24 511.756 2033.27 510.72 2033.3 509.653 C 2033.25 501.57 2030.58 497.057 2025.45 490.948 C 2024.87 490.204 2024.28 489.459 2023.68 488.692 C 2017.64 481.099 2009.19 474.56 1999.45 472.948 C 1983.51 471.45 1969.75 475.534 1959.38 488.546 Z M 2085.45 482.948 C 2084.56 483.735 2084.56 483.735 2083.65 484.538 C 2077.38 490.444 2071.21 496.923 2070.64 505.841 C 2070.64 507.982 2070.67 510.124 2070.73 512.265 C 2070.74 513.402 2070.75 514.54 2070.76 515.712 C 2070.79 519.313 2070.87 522.911 2070.95 526.511 C 2070.98 528.962 2071 531.413 2071.02 533.864 C 2071.07 538.317 2071.13 542.768 2071.23 547.22 C 2071.25 548.111 2071.26 549.003 2071.28 549.921 C 2071.23 551.943 2071.23 551.943 2072.45 552.948 C 2074.91 553.048 2077.34 553.084 2079.8 553.078 C 2080.57 553.079 2081.34 553.081 2082.13 553.083 C 2084.69 553.087 2087.24 553.084 2089.8 553.081 C 2091.56 553.082 2093.33 553.083 2095.1 553.084 C 2098.81 553.085 2102.52 553.083 2106.22 553.079 C 2110.99 553.073 2115.76 553.076 2120.52 553.082 C 2124.17 553.086 2127.82 553.085 2131.47 553.082 C 2133.23 553.081 2134.99 553.082 2136.75 553.084 C 2139.2 553.087 2141.65 553.083 2144.1 553.078 C 2145.2 553.081 2145.2 553.081 2146.33 553.084 C 2149.67 553.364 2149.67 553.364 2152.45 551.948 C 2152.55 550.321 2152.57 548.691 2152.57 547.061 C 2152.57 546.02 2152.57 544.979 2152.57 543.907 C 2152.56 542.774 2152.55 541.642 2152.55 540.475 C 2152.55 539.323 2152.55 538.17 2152.55 536.982 C 2152.54 533.283 2152.53 529.585 2152.51 525.886 C 2152.51 523.385 2152.51 520.884 2152.5 518.384 C 2152.49 512.238 2152.47 506.093 2152.45 499.948 C 2151.79 499.948 2151.13 499.948 2150.45 499.948 C 2150.14 498.958 2150.14 498.958 2149.83 497.948 C 2147.93 493.797 2145.34 490.464 2142.45 486.948 C 2141.95 486.335 2141.44 485.721 2140.93 485.089 C 2134.65 478.15 2125.53 473.389 2116.17 472.71 C 2103.98 472.47 2094.73 474.738 2085.45 482.948 Z"/>
                  </g>
                </svg>
            </div>
  
            <!-- end duplicate skyline -->
            <!-- Quick Actions: Citymapper-style two badges -->
            <div id="quick-actions" class="quick-actions-panel">
                <button id="action-bus" class="qa-btn" title="Show buses">
                    <div class="qa-icon qa-icon-bus">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="4" y="4" width="16" height="14" rx="2" fill="#00B2FF" stroke="white" stroke-width="1.5"/>
                            <rect x="6" y="6" width="12" height="6" fill="#E6F2FF"/>
                            <circle cx="8" cy="16" r="1.5" fill="white"/>
                            <circle cx="16" cy="16" r="1.5" fill="white"/>
                            <line x1="12" y1="6" x2="12" y2="12" stroke="#00B2FF" stroke-width="1"/>
                        </svg>
                    </div>
                    <div class="qa-label">Bus</div>
                </button>
                <button id="action-walk" class="qa-btn" title="Walk to stop">
                    <div class="qa-icon qa-icon-walk">
                        <svg width="28" height="28" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M67.9,22.6c5.7,0.4,10.8-3.8,11.3-9.7c0.4-5.7-3.8-10.8-9.7-11.3c-5.7-0.4-10.8,3.8-11.3,9.7C57.8,17.1,62.2,22.2,67.9,22.6" fill="currentColor" stroke="#ffffff" stroke-width="6"/>
                            <path d="M59,26.9c2-1.5,4.5-2.3,7.3-2.2c3.5,0.3,6.6,2.5,8.3,5.1l10.5,20.9l14.3,10c1.2,1,2,2.5,1.9,4.1c-0.1,2.6-2.5,4.5-5.1,4.2 c-0.7,0-1.5-0.3-2.2-0.7L78.6,57.8c-0.4-0.4-0.9-0.9-1.2-1.5l-4-7.8l-4.7,20.8l18.6,22c0.4,0.7,0.7,1.5,0.9,2.2l5,26.5 c0,0.6,0,1,0,1.5c-0.3,4-3.7,6.7-7.6,6.6c-3.2-0.3-5.6-2.6-6.4-5.6l-4.7-24.7L59.4,81l-3.5,16.1c-0.1,0.7-1.2,2.3-1.5,2.9L40,124.5 c-1.5,2.2-3.8,3.7-6.6,3.4c-4-0.3-6.9-3.7-6.6-7.6c0.1-1.2,0.6-2.2,1-3.1l13.5-22.5L52.5,45l-7.3,5.9l-4,17.7c-0.4,2.2-2.6,4.1-5,4 c-2.6-0.1-4.5-2.5-4.4-5.1c0-0.1,0-0.4,0.1-0.6l4.5-20.6c0.3-0.9,0.7-1.6,1.5-2.2L59,26.9z" fill="currentColor" stroke="#ffffff" stroke-width="6"/>
                        </svg>
                    </div>
                    <div class="qa-label">Walk</div>
                </button>
            </div>

            <div class="routes-header hidden">
                <div id="mode-bus-label" class="mode-label">
                    <svg class="mode-bus-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="4" width="16" height="14" rx="2" fill="#00B2FF" stroke="white" stroke-width="1.5"/>
                        <rect x="6" y="6" width="12" height="6" fill="#E6F2FF"/>
                        <circle cx="8" cy="16" r="1.5" fill="white"/>
                        <circle cx="16" cy="16" r="1.5" fill="white"/>
                        <line x1="12" y1="6" x2="12" y2="12" stroke="#00B2FF" stroke-width="1"/>
                    </svg>
                    <span class="mode-bus-text">Bus</span>
                </div>
            </div>

            <div class="routes-list hidden" id="routes-list">
                <div class="loading-spinner"></div>
            </div>
        </div>
    </div>

    <!-- Station Selector Modal -->
    <div id="station-modal" class="modal-overlay hidden">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h3>Select Station</h3>
                <button id="close-modal" class="close-btn">‚úï</button>
            </div>
            <input type="text" id="station-search" class="station-search" placeholder="Search stations...">
            <div class="station-list" id="station-list">
                <!-- Station items will be injected here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./leaflet.js"></script>
    <script src="./tile-cache.js"></script>
    <script src="./weather.js"></script>
    <script src="./app.js"></script>

    <!-- Service Worker Registration for Tile Caching -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered for tile caching:', registration.scope);
                        // Force update to get new version
                        registration.update();
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
    </script>

    <!-- Install UI removed -->
</body>

</html>
