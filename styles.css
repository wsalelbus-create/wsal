:root {
    --primary-color: #37AB2F;
    /* Citymapper-style vibrant green - arrival panel color */
    --etusa-blue: #00d2ff;
    /* ETUSA Blue for Buses */
    --accent-color: #37AB2F;
    /* Green accent */
    --badge-green: #2E9127;
    /* Slightly darker green for badge rectangles (about 15% darker) */
    --bg-color: #ffffff;
    /* Clean background */
    --text-main: #333333;
    /* Dark text for readability */
    --text-light: #ffffff;
    /* Light text for headers */
    --text-muted: #8e8e93;
    --card-bg: #ffffff;
    --glass-bg: rgba(255, 255, 255, 0.95);
    --glass-border: rgba(0, 0, 0, 0.05);
    --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.1);
    --shadow-strong: 0 10px 40px rgba(0, 0, 0, 0.2);
    /* Dark blue used for quick-action icons (consistent with map icons) */
    --icon-dark-blue: #0A5AA3;
    /* Arrivals panel color */
    --arrivals-green: #37AB2F;
    /* Live radar orange (Citymapper-style) */
    --live-orange: #FFC400;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: 'Outfit', sans-serif;
    background: #e8e8e8; /* match map grey - no blue background to reveal */
    color: var(--text-main);
    width: 100vw;
    min-height: 100vh;
    /* Allow page to grow */
    overflow-x: hidden;
    /* Disable document-level scroll to remove rubber-band */
    overflow-y: hidden;
    margin: 0;
    padding: 0;
    /* NO padding on body - fixed elements handle safe area themselves */
}

/* Prevent page rubber-band globally; only internal containers may scroll */
html, body {
    height: 100%;
    overscroll-behavior: none;
    overscroll-behavior-y: none;
}

.app-container {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    /* Allow container to grow */
    position: relative;
    background: #e8e8e8; /* match map grey - seamless with map */
    /* Extend behind status bar */
    margin-top: 0;
}

/* Utility */
.hidden { display: none !important; }

/* =========================================
   1. TOP MAP SECTION (60%)
   ========================================= */
.map-view-container {
    height: calc(var(--vh, 1vh) * 100); /* full viewport - map extends behind panel */
    position: relative;
    width: 100%;
    z-index: 1;
    overflow: hidden;
    background: #e8e8e8;
    padding-bottom: 0;
    margin-bottom: 0;
}

/* Expanded map state - when panel is collapsed */
.map-view-container.expanded {
    height: calc(var(--vh, 1vh) * 82);
}

#map-container {
    /* Moderate oversizing for parallax without performance hit */
    width: 130%;
    height: 130%;
    min-height: 360px;
    background: #e8e8e8;
    position: absolute;
    /* Position so map center is at ~30vh (center of visible area when panel at 40vh) */
    /* With 130% height, center is at 65% from top */
    /* To place center at 30vh: top = 30vh - 65% = 30vh - 0.65*100vh = -35vh */
    top: calc(30vh - 65%);
    left: -15%;
    /* Performance optimizations */
    transform: translate3d(0, 0, 0);
    transform-origin: center center;
}

/* Remove individual pane rotation - we rotate the whole container */

/* Header Floating on Map */
.glass-header {
    position: absolute;
    top: calc(11px + env(safe-area-inset-top));
    /* Below status bar */
    left: 16px;
    right: 16px;
    z-index: 999; /* below arrivals panel (1000) so logo goes under when panel dragged up */
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Logo Area */
.logo-area {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
}
.logo-area h1 {
    font-family: 'Cairo', sans-serif;
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--primary-color);
    text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8);
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    padding: 6px 12px;
    border-radius: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-top: -5px; /* Nudge Arabic badge up by total 5px */
}

/* Settings badge (gear) - FIXED position outside header to stay above panel */
.settings-badge {
    appearance: none;
    border: none;
    cursor: pointer;
    background: white;
    color: #333;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: fixed; /* Fixed like back button */
    top: calc(70px + env(safe-area-inset-top)); /* Same level as GPS location button */
    left: 16px;
    z-index: 10100; /* Above arrivals panel (1000) */
}
.settings-badge:active { transform: scale(0.98); }

/* Gear icon size inside the settings badge */
.settings-badge svg {
    width: 24px;
    height: 24px;
}

/* Back badge (arrow) shown in bus/walk modes instead of settings */
.back-badge {
    appearance: none;
    border: none;
    cursor: pointer;
    background: var(--arrivals-green);
    color: #fff;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: fixed; /* keep visible during scroll */
    top: calc(11px + env(safe-area-inset-top));
    left: 16px;
    z-index: 10050; /* ensure above all UI, including arrivals panel */
}
.back-badge svg { width: 20px; height: 20px; }
.back-badge:active { transform: scale(0.98); }

.live-badge {
    background: var(--primary-color);
    color: white;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 12px;
    margin-left: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    animation: pulse 2s infinite;
}

.time-display {
    font-family: 'Outfit', sans-serif;
    font-weight: 700;
    font-size: 1.1rem;
    color: #333;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    padding: 6px 12px;
    border-radius: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

/* Map Overlay Info (Distance) */
.map-overlay-info {
    position: absolute;
    top: 70px;
    /* Below header */
    left: 50%;
    transform: translateX(-50%);
    z-index: 90;
}

.map-distance {
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
}

/* Walking Time Badge (Citymapper Style - Compact) */
.walking-time-badge {
    position: absolute;
    /* Stays with map, not viewport */
    top: calc(11px + env(safe-area-inset-top));
    /* Below status bar/notch */
    right: 16px;
    z-index: 200;
    background: white;
    padding: 8px 12px;
    /* Compact padding */
    border-radius: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 6px;
    /* Reduced gap */
    font-weight: 700;
    font-size: 0.95rem;
    /* Slightly larger number */
    color: #333; /* Match .map-control-btn icon color */
}

.walking-time-badge .walk-icon {
    color: var(--primary-color);
    width: 20px;
    height: 20px;
}

.walking-time-badge #walk-time-text {
    color: #333;
    font-weight: 700;
}

/* Calorie Badge (appears under walking badge) */
.calorie-badge {
    background: white;
    color: #333;
    padding: 6px 10px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-weight: 700;
    font-size: 0.9rem;
    align-self: flex-end; /* right-align within the controls stack */
}
.calorie-badge .cal-icon {
    color: var(--primary-color);
    width: 18px;
    height: 18px;
}

/* Map Controls Stack (Location & Compass) */
.map-controls-stack {
    position: absolute;
    /* Stays with map, not viewport */
    top: calc(70px + env(safe-area-inset-top));
    /* Below walking badge and status bar */
    right: 16px;
    z-index: 200;
    display: flex;
    flex-direction: column;
    align-items: flex-end; /* keep buttons aligned to the right */
    gap: 8px;
}

.map-control-btn {
    width: 44px;
    height: 44px;
    background: white;
    border: none;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    color: #333;
    position: relative;
}

.map-control-btn:hover {
    background: #f5f5f5;
    transform: scale(1.05);
}

.map-control-btn:active {
    transform: scale(0.95);
    background: var(--primary-color);
    color: white;
}

/* Compass button active state (rotation mode) */
.map-control-btn.compass-active {
    background: #30D158;
    color: white;
}

.compass-label {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 11px;
    font-weight: 700;
    color: #333;
    pointer-events: none;
}


/* =========================================
   2. FLOATING CONTROLS (Between Map & Arrivals)
   ========================================= */
.floating-controls {
    position: absolute; /* absolute to move with panel */
    top: -22px; /* 30% above panel edge, 70% inside - like Citymapper */
    left: 16px;
    right: 16px;
    z-index: 1001; /* above arrivals panel (1000) */
    pointer-events: none; /* allow clicks through container */
}

.station-selector-card {
    background: white;
    border-radius: 16px;
    padding: 0; /* no padding, rows handle their own */
    box-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.08),
        0 4px 12px rgba(0, 0, 0, 0.12),
        0 8px 24px rgba(0, 0, 0, 0.16),
        0 12px 32px rgba(0, 0, 0, 0.12); /* multiple shadow layers for strong depth */
    display: flex;
    flex-direction: column;
    pointer-events: auto; /* re-enable clicks on the card itself */
    overflow: hidden; /* clip rounded corners */
}

.selector-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 16px; /* even shorter padding */
    cursor: pointer;
    transition: background 0.2s;
}

.selector-row:active {
    background: #f5f5f5;
}

.selector-icon-circle {
    width: 40px; /* smaller circle */
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.selector-icon-circle svg {
    width: 20px; /* smaller icon */
    height: 20px;
}

.home-icon {
    background: #4A7C9E; /* blue-grey like Citymapper home */
}

.places-icon {
    background: #4A7C9E; /* blue like Citymapper places */
}

.selector-text {
    flex: 1;
    overflow: hidden;
}

.selector-text h2 {
    font-size: 1.05rem;
    font-weight: 600;
    color: var(--text-main);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: 0;
}

.selector-divider {
    height: 1px;
    background: #e8e8e8;
    margin: 0 18px; /* inset divider like Citymapper */
}


/* =========================================
   3. ARRIVALS PANEL (Bottom 40%)
   ========================================= */
.arrivals-panel {
    /* Fixed bottom sheet - JS controls height/position via setPanelVisibleHeight() */
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    height: calc(var(--vh, 1vh) * 85); /* start at max height, JS will position via transform */
    max-height: none;
    background: var(--primary-color);
    /* Citymapper-style green background */
    border-radius: 16px 16px 0 0;   /* match selector bar radius */
    box-shadow: none;               /* remove hairline */
    z-index: 1000;                  /* above map/controls; under header/back badge */
    /* Skyline size made global so children (routes-list) can reserve space */
    --skyline-max-height: 180px; /* fixed smaller height - identical in Safari and PWA */
    padding: 16px;
    padding-top: 120px;             /* enough space for floating selector (70px) + spacing (32px) + first element */
    --panel-pad-bottom: calc(6px + env(safe-area-inset-bottom));
    padding-bottom: var(--panel-pad-bottom); /* safe area */
    display: flex;
    flex-direction: column;         /* internal layout */
    align-items: stretch;
    overflow: visible;              /* allow floating controls to show above panel */
    touch-action: none;             /* gestures handled by JS for sheet drag */
    /* Initial position: collapsed (40vh visible) - prevents flash at bottom on load */
    transform: translateY(calc(var(--vh, 1vh) * 45)); /* start pushed down (85vh - 40vh = 45vh offset) */
    transition: transform 0.25s ease;  /* smooth translate change */
    will-change: transform;
}

/* Expanded sheet height (drag up) */
.arrivals-panel.expanded { height: calc(var(--vh, 1vh) * 85); /* expands to 85% when user drags up */ }

/* Visible sheet grabber for better affordance and touch target */
.sheet-grabber {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 48px;
    height: 6px;
    border-radius: 3px;
    background: rgba(255, 255, 255, 0.4);
    pointer-events: auto; /* receive touch events for reliable drag start */
}

/* When selector bar is hidden (detailed screen), reduce top padding */
.arrivals-panel.no-selector {
    /* Provide room for the stop badge overlay + station name */
    padding-top: 64px;
}

/* Collapsed arrivals when map expanded */
.arrivals-panel.collapsed {
    min-height: calc(var(--vh, 1vh) * 20);
    /* 20% when map expanded - use polyfilled vh for Safari/PWA consistency */
}

/* Walking Time Card */
.walking-time {
    background: var(--primary-color);
    /* Green background like Citymapper 'Walk' */
    color: white;
    padding: 12px 16px;
    border-radius: 12px;
    margin-top: 20px;
    /* Space from controls overlap */
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(53, 199, 89, 0.3);
}

.walk-icon {
    font-size: 1.3rem;
}

/* Routes List */
.routes-header {
    display: flex;
    justify-content: flex-start; /* left align */
    align-items: center;
    margin-top: 0;                  /* no extra margin - floating-controls handles spacing */
    margin-bottom: 12px;            /* space above first card */
    padding: 0 16px;                /* align with cards content */
}

.routes-header h3 {
    font-size: 1.1rem;
    color: white;
}

.live-indicator {
    font-size: 0.75rem;
    color: var(--primary-color);
    font-weight: 700;
    background: #f0fdf4;
    padding: 4px 8px;
    border-radius: 10px;
}

/* Mode label (Bus) â€“ simple icon + text, no badge */
.mode-label {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: #fff; /* white like Citymapper header */
    font-weight: 800;
    font-size: 1.1rem; /* revert to larger size */
}
.mode-bus-icon {
    color: var(--text-main);
    width: 32px;   /* match .qa-icon svg */
    height: 32px;  /* match .qa-icon svg */
}
.mode-bus-text {
    font-weight: 800;
    font-size: 1.1rem; /* revert to larger size */
    color: #fff;
}

.routes-list {
    display: flex;
    flex-direction: column;
    gap: 16px; /* slightly more space between cards */
    /* Reserve space so cards never overlap skyline backdrop */
    padding-bottom: 185px; /* tight spacing - identical in Safari and PWA */
    flex: 1 1 auto;                 /* take remaining space in panel */
    min-height: 0;                  /* allow flex child to shrink for scroll */
    overflow-y: auto;               /* default, will be disabled when not expanded */
    -webkit-overflow-scrolling: touch;
}

/* Disable list scroll when the sheet is collapsed; enable only when expanded */
.arrivals-panel:not(.expanded) .routes-list { overflow: hidden; touch-action: none; }
.arrivals-panel.expanded .routes-list { overflow-y: auto; touch-action: pan-y; }

/* In Bus mode, reduce panel padding since selector bar is hidden */
.arrivals-panel.bus-mode {
    padding-top: 32px; /* reduced from 120px - no selector bar in bus mode */
}

/* Walking detailed screen: both bus-mode and no-selector - need more space for badge overlay */
.arrivals-panel.bus-mode.no-selector {
    padding-top: 80px; /* enough space for badge overlay (44px) + spacing */
}

/* In Bus mode, make the list non-scrollable and let it size to content.
   The sheet itself will expand up to the viewport to reveal items. */
.arrivals-panel.bus-mode .routes-list {
    overflow: hidden;            /* no internal scroll */
    flex: 0 0 auto;              /* do not take remaining space */
    min-height: auto;            /* allow intrinsic height */
    max-height: none;            /* no cap */
    -webkit-overflow-scrolling: auto;
    touch-action: none;          /* gestures reserved for sheet drag */
    /* Reserve skyline height so the last card never overlaps backdrop */
    padding-bottom: 185px; /* tight spacing - identical in Safari and PWA */
}

/* Walking screen (detailed mode) with single card - ensure enough space below */
.arrivals-panel.no-selector .routes-list {
    padding-bottom: 220px !important; /* extra space for single card to sit above skyline */
    min-height: 300px; /* ensure list has minimum height even with one card */
}

/* Hide scrollbars for bottom-sheet feel */
.routes-list::-webkit-scrollbar { display: none; }
.arrivals-panel::-webkit-scrollbar { display: none; }

/* =============================
   BUS SCREEN: Station Cards
   ============================= */
.station-card {
    background: white;
    /* White cards like Citymapper */
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 16px;
    padding: 14px 16px 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    position: relative; /* anchor overlay icon */
}

/* Overlay bus icon placed outside the card, aligned above the badge */
.detail-bus-overlay {
    position: absolute;
    left: 26px;   /* 16px card padding + (44 - 24)/2 */
    top: -14px;   /* float above the card edge with small gap */
    z-index: 120; /* above arrivals panel contents */
    pointer-events: none; /* do not block taps */
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.15));
}
.detail-bus-overlay svg { width: 24px; height: 24px; display: block; }

/* Panel-level overlay (for detailed screen) */
.detail-bus-overlay-panel {
    position: absolute;
    left: 16px;   /* align with panel padding */
    top: 12px;    /* inside panel, above first card */
    z-index: 130; /* above cards */
    pointer-events: none;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.15));
}
.detail-bus-overlay-panel svg { width: 44px; height: 44px; display: block; }
.detail-bus-overlay-row { display: flex; align-items: center; gap: 10px; color: #fff; }
.detail-bus-overlay-name { font-weight: 800; font-size: 1.1rem; line-height: 1; }

.station-header {
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative; /* anchor overlay badge */
}

.station-badge {
    width: 44px; /* square with rounded corners */
    height: 44px;
    border-radius: 10px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: 900;
    font-size: 0.95rem;
    flex: 0 0 44px;
}
.station-badge span { line-height: 1; }

.station-title { flex: 1; min-width: 0; }
.station-name { font-weight: 800; font-size: 1.05rem; color: #666; } /* only this stays bold */
.station-serves { font-size: 0.85rem; color: #666; margin-top: 2px; font-weight: 600; } /* lighter weight */

.station-distance { font-weight: 600; font-size: 0.9rem; color: #666; } /* lighter weight */

.station-divider {
    border-top: 1px solid #eaeaea;
    margin: 10px 0 6px;
}

.station-arrivals { display: flex; flex-direction: column; gap: 8px; }
.station-arrivals.loading { opacity: 0.85; }
.loading-row { display: flex; align-items: center; justify-content: space-between; padding: 6px 0; }
.loading-text { color: var(--text-muted); font-weight: 700; font-size: 0.9rem; }
.spinner-ios {
    width: 18px; height: 18px; display: inline-block; position: relative;
}
.spinner-ios:before, .spinner-ios:after {
    content: ""; position: absolute; inset: 0; border-radius: 50%;
    border: 2px solid rgba(0,0,0,0.15); border-top-color: rgba(0,0,0,0.4);
    animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Apple-style loader (provided by user) */
/* HTML: <div class="loader"></div> */
.loader {
  width: 50px;
  aspect-ratio: 1;
  display: grid;
  border-radius: 50%;
  background:
    linear-gradient(0deg ,rgb(0 0 0/50%) 30%,#0000 0 70%,rgb(0 0 0/100%) 0) 50%/8% 100%,
    linear-gradient(90deg,rgb(0 0 0/25%) 30%,#0000 0 70%,rgb(0 0 0/75% ) 0) 50%/100% 8%;
  background-repeat: no-repeat;
  animation: l23 1s infinite steps(12);
}
.loader::before,
.loader::after {
   content: "";
   grid-area: 1/1;
   border-radius: 50%;
   background: inherit;
   opacity: 0.915;
   transform: rotate(30deg);
}
.loader::after {
   opacity: 0.83;
   transform: rotate(60deg);
}
@keyframes l23 {
  100% {transform: rotate(1turn)}
}

/* Small variant for cards */
.loader-sm { width: 18px; }

.station-arrival-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px; /* more space pushes countdown group to the right */
}

/* Left side of arrival row: chip + destination */
.route-left {
    display: inline-flex;
    align-items: center;
    gap: 10px;
}
.chip-dest {
    font-weight: 600; /* lighter weight like Citymapper */
    color: #666;
    font-size: 0.95rem;
}

.route-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 8px;
    border: 1px solid #e6e6e6; /* border-only rounded square */
    border-radius: 10px;
    background: transparent;
}
.route-chip .mini-bus { width: 16px; height: 16px; display: block; }
.route-chip .chip-number { font-weight: 800; font-size: 0.95rem; color: var(--text-main); }

/* Route Item Card */
.route-item {
    background: white;
    border: 1px solid #f0f0f0;
    padding: 14px 16px;
    border-radius: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
    transition: transform 0.2s;
}

.route-item:active {
    transform: scale(0.98);
    background: #fafafa;
}

.route-info {
    display: flex;
    align-items: center;
    gap: 14px;
    flex: 1;
}

.route-number {
    background: var(--etusa-blue);
    color: white;
    font-weight: 800;
    padding: 6px 10px;
    border-radius: 8px;
    font-size: 1rem;
    min-width: 50px;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 210, 255, 0.3);
}

.route-dest {
    font-weight: 700;
    font-size: 1rem;
    color: var(--text-main);
    line-height: 1.2;
}

/* Arrival Time Styling */
.route-time {
    text-align: right;
    min-width: 70px;
}

.route-time .time-inline {
    display: inline-flex;
    align-items: flex-start; /* align to top like Citymapper */
    gap: 4px; /* more space between number and "min" */
}
.route-time .live-radar {
    transform: rotate(-50deg);
    transform-origin: center;
    margin-right: 0px;
    width: 14px;
    height: 14px;
    flex-shrink: 0;
}

.time-big {
    font-size: 1.1rem;
    font-weight: 700;
    color: #333; /* darker gray for countdown numbers */
    line-height: 1;
}

.time-unit {
    font-size: 0.7rem;
    color: #999; /* lighter gray for "min" text */
    font-weight: 600;
    text-transform: lowercase;
    line-height: 1;
}

/* Stack for live signal icon above minutes */
.route-time .time-stack {
    display: inline-flex;
    flex-direction: row;
    align-items: flex-start; /* align to top */
    gap: 1px; /* very tight */
    color: #333; /* darker gray */
}
.route-time .time-stack .live-signal {
    display: block;
    margin-bottom: 0;
    color: var(--primary-color);
    opacity: 0.95;
}


/* =========================================
   4. MODALS & UTILS
   ========================================= */

/* Station Modal */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    display: flex;
    align-items: flex-end;
    /* Sheet style */
    z-index: 1000;
    animation: fadeIn 0.2s ease;
}

.modal-overlay.hidden {
    display: none;
}

.modal-content {
    width: 100%;
    height: 80%;
    /* Takes up most of screen */
    background: white;
    border-radius: 24px 24px 0 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.3s ease;
}

.modal-header {
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #f0f0f0;
}

.modal-header h3 {
    font-size: 1.2rem;
    color: var(--text-main);
}

.close-btn {
    background: #f2f2f7;
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-size: 1.2rem;
    color: #666;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

.station-search {
    margin: 16px;
    padding: 12px 16px;
    background: #f2f2f7;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    font-family: 'Outfit', sans-serif;
    outline: none;
}

.station-search:focus {
    background: #e5e5ea;
    box-shadow: 0 0 0 2px var(--primary-color);
}

.station-list {
    flex: 1;
    overflow-y: auto;
    padding: 0 16px 20px;
}

.station-list-item {
    padding: 16px;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}

.station-list-item:active {
    background: #f9f9f9;
}

.station-list-item h4 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-main);
    margin-bottom: 4px;
}

.station-list-item p {
    font-size: 0.85rem;
    color: var(--text-muted);
}


/* Animations */
@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes slideUp {
    from {
        transform: translateY(100%);
    }

    to {
        transform: translateY(0);
    }
}

@keyframes pulse {
    0% {
        transform: scale(1);
        opacity: 1;
    }

    50% {
        transform: scale(1.05);
        opacity: 0.8;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Map Crosshair (Citymapper style) */
.map-crosshair {
    position: fixed; /* fixed to viewport, not map-view */
    top: 30vh; /* center in visible map area (not oversized map) */
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1001; /* above map (1), below panel (1003) */
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.map-crosshair.visible {
    opacity: 1;
}

.map-crosshair svg {
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.loading-spinner {
    width: 30px;
    height: 30px;
    border: 3px solid #f0f0f0;
    border-top-color: var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* Footer (Hidden mostly but basic styles) */
.glass-footer {
    display: none;
}

/* legacy version-footer removed */

/* Ensure no accidental bottom border on the arrivals panel */
.arrivals-panel { border-bottom: 0; }

/* =============================
   UTILITIES
   ============================= */
.hidden { display: none !important; }

/* =============================
   ARRIVALS PANEL THEME (GREEN)
   ============================= */
.arrivals-panel.panel-green { background: var(--primary-color); }

/* =============================
   QUICK ACTIONS (Citymapper-style)
   ============================= */
.quick-actions-panel {
    background: var(--primary-color);  /* same as arrival panel #5AA843 */
    border-radius: 16px;
    padding: 6px 8px;               /* tighter container padding */
    display: flex;
    gap: 6px;                       /* slightly smaller gap between tiles */
    justify-content: center;
    align-items: center;
    margin: 0 0 20px 0;             /* no top margin - floating-controls handles spacing globally */
    box-shadow: none;               /* flat */
}

.qa-btn {
    appearance: none;
    border: none;                   /* no outline */
    background: var(--badge-green);  /* darker green badge background #4C8D39 */
    color: #fff;
    width: 70px;                    /* rectangular - wider */
    height: 56px;                   /* rectangular - shorter */
    padding: 6px 8px;
    border-radius: 12px;            /* rounded rectangle */
    display: flex;
    flex-direction: column;         /* icon above label */
    align-items: center;
    justify-content: center;
    gap: 3px;                       /* tight spacing */
    font-weight: 800;
    letter-spacing: 0.2px;
    box-shadow: none;               /* fully flat */
    transition: transform .15s ease, background .2s ease;
}

.qa-btn:active { 
    transform: scale(0.98); 
    background: #267821;  /* slightly darker on press */
}
.qa-icon { display: flex; align-items: center; justify-content: center; }
.qa-icon svg { width: 28px; height: 28px; }
.qa-icon-walk svg { width: 25px; height: 25px; transform: translateY(1px); }
.qa-icon-bus svg { transform: translateY(1px); }
.qa-label { font-size: 0.8rem; font-weight: 700; line-height: 1; transform: translateY(-1px); }

/* Ad Placeholder - Citymapper style */
.ad-placeholder {
    background: white;
    border-radius: 16px;
    padding: 16px;
    margin: 0 0 20px 0;
    min-height: 100px;
    display: block;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    overflow: hidden;
}

.ad-demo-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 80px;
}

.ad-label {
    color: #999;
    font-size: 0.7rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Google Ads will style themselves, this just ensures they fit */
.ad-placeholder ins {
    display: block !important;
    width: 100% !important;
}

/* =============================
   CITY SKYLINE BACKDROP (Algiers-inspired)
   ============================= */
.arrivals-panel .quick-actions-panel,
.arrivals-panel .routes-header,
.arrivals-panel .routes-list { position: relative; z-index: 1; }

/* Skyline: pinned to viewport bottom, always below panel content */
.arrivals-panel .skyline-inline {
  position: fixed !important; /* fixed to viewport - always at bottom */
  bottom: 0 !important; /* sit flush at viewport bottom */
  left: 0 !important;
  right: 0 !important;
  height: 180px !important; /* fixed smaller height - identical in Safari and PWA */
  max-height: 180px !important;
  opacity: 1 !important;
  margin: 0 !important;
  pointer-events: none !important;
  z-index: 0 !important; /* behind all content */
  overflow: hidden !important; /* clip any overflow */
  transform: translateZ(0) !important; /* force GPU layer to prevent repaints */
  will-change: auto !important;
}

/* Ensure SVG scales to container height */
.arrivals-panel .skyline-inline svg { 
  width: 100%; 
  height: 100%; 
  display: block;
}

/* Force one uniform color across all skyline layers */
.arrivals-panel .skyline-inline svg * {
  fill: #2E9127 !important; /* darker green matching badge color */
  fill-opacity: 1 !important;
  opacity: 1 !important;
  stroke: none !important;
}

/* cleaned: removed legacy footer skyline rules */

/* Fix circle stroke width during zoom - prevent zoom animation scaling */
.leaflet-overlay-pane svg path {
    vector-effect: non-scaling-stroke;
}

/* Disable zoom animation on distance circles */
.leaflet-overlay-pane .leaflet-zoom-animated {
    transition: none !important;
}


/* =============================
   FULL-SCREEN BUS MAP VIEW
   ============================= */
.bus-map-screen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100vh;
    background: #f5f5f5;
    z-index: 20000;
    display: flex;
    flex-direction: column;
    transition: opacity 0.3s ease, transform 0.3s ease;
}

.bus-map-screen.hidden {
    opacity: 0;
    pointer-events: none;
    transform: translateY(20px);
}

/* Header */
.bus-map-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: calc(60px + env(safe-area-inset-top));
    padding-top: env(safe-area-inset-top);
    background: #2c2c2e;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 20001;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.bus-map-back-btn {
    position: absolute;
    left: 16px;
    top: calc(env(safe-area-inset-top) + 10px);
    width: 40px;
    height: 40px;
    background: transparent;
    border: none;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: opacity 0.2s ease;
}

.bus-map-back-btn:active {
    opacity: 0.6;
}

.bus-map-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
    letter-spacing: 0.3px;
}

/* Map Container - light grey background with zoom/scroll */
.bus-map-container {
    flex: 1;
    overflow: hidden;
    padding: calc(80px + env(safe-area-inset-top)) 16px calc(16px + env(safe-area-inset-bottom)) 16px;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    touch-action: none;
}

/* Wrapper for transform */
.bus-map-wrapper {
    display: block;
    position: relative;
    transform-origin: center center;
    will-change: transform;
}

/* White frame wrapper - centered, zoomable */
.bus-map-image {
    display: block;
    background: white;
    border-radius: 0;
    box-shadow: none;
    padding: 20px;
    width: 90vw;
    max-width: 90vw;
    height: auto;
    user-select: none;
    -webkit-user-select: none;
    -webkit-user-drag: none;
}

.bus-map-image:active {
    cursor: default;
}
